<!DOCTYPE html><html lang="en"><head><script>(function(){const e=localStorage.getItem('theme');e==='sunlight'&&document.documentElement.classList.add('sunlight-mode')})()</script><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>Sdel | Explore</title><script src="https://cdn.tailwindcss.com"></script><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800;900&display=swap" rel="stylesheet"><script src="https://unpkg.com/lucide@latest"></script><script src="nav.js"></script><style>html,body{user-select:none;-webkit-user-select:none;height:100%}*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;-webkit-tap-highlight-color:transparent}body{background-color:#000;color:#fff;overflow-x:hidden;transition:background-color .3s;display:flex;flex-direction:column}.text-sdel{color:#f60}.bg-sdel{background-color:#f60}.post-card{background:rgba(15,15,15,.4);border-bottom:1px solid rgba(255,255,255,.08);transition:background .2s}.post-card:active{background:rgba(255,102,0,.05)}.tab-btn{transition:all .3s ease;border-bottom:3px solid transparent;opacity:.5;font-weight:900;text-transform:uppercase;font-size:10px;letter-spacing:.1em}.tab-active{color:#f60;border-bottom:3px solid #f60;opacity:1}#post-input{resize:none;background:0 0;border:none;outline:0;width:100%;color:#fff;font-size:15px;transition:min-height .2s}.composer-expanded{background:rgba(255,102,0,.05)!important;border:1px solid rgba(255,102,0,.2)!important;border-radius:16px;padding:16px!important}#mention-list{position:absolute;background:#0a0a0a;border:1px solid #222;border-radius:16px;width:220px;z-index:5000;display:none;box-shadow:0 15px 40px rgba(0,0,0,.6);overflow:hidden}.mention-item{padding:14px 18px;border-bottom:1px solid #1a1a1a;font-size:12px;font-weight:800;text-transform:uppercase;cursor:pointer;transition:.2s;color:#fff}.mention-item:hover{background:#f60;color:#000}.sunlight-mode body{background-color:#fff;color:#121212}.sunlight-mode nav,.sunlight-mode .sticky{background-color:rgba(255,255,255,.95)!important;border-color:#f0f0f0!important}.sunlight-mode .fixed.bottom-0{background-color:rgba(255,255,255,.9)!important;border-color:#e4e4e7!important}.sunlight-mode .post-card{background:#fff;border-color:#f0f0f0}.sunlight-mode .post-card:active{background:#f9f9f9}.sunlight-mode #post-input{color:#121212}.sunlight-mode .text-zinc-200{color:#27272a!important}.sunlight-mode .text-zinc-500{color:#71717a!important}.sunlight-mode #mention-list{background:#fff;border-color:#eee;box-shadow:0 10px 30px rgba(0,0,0,.1)}.sunlight-mode .mention-item{color:#121212;border-color:#f5f5f5}.sunlight-mode .composer-expanded{background:#fff7f2!important;border-color:#ffd6ba!important}.sunlight-mode .modal-content{background:#fff;border-color:#eee;color:#121212}.sunlight-mode .bg-zinc-900{background-color:#f4f4f5}.sunlight-mode .action-sheet{background:#fff;border-color:#eee}.sunlight-mode .search-container{background:#f4f4f5;border-color:#e4e4e7}.sunlight-mode .search-container input{color:#121212;background:#f4f4f5}.sunlight-mode .search-container input::placeholder{color:#71717a}.sunlight-mode .text-white{color:#121212}.sunlight-mode .text-white\/60{color:#71717a}.sunlight-mode .text-sdel{color:#f60}#toast{position:fixed;top:20px;left:50%;transform:translateX(-50%) translateY(-100px);background:#f60;color:#000;padding:12px 24px;border-radius:12px;font-weight:900;font-size:12px;text-transform:uppercase;transition:transform .4s cubic-bezier(.175,.885,.32,1.275);z-index:9999}#toast.show{transform:translateX(-50%) translateY(0)}.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.9);z-index:2000;display:none;align-items:center;justify-content:center;backdrop-filter:blur(12px);padding:20px}.modal-content{background:#111;width:100%;max-width:400px;border-radius:28px;padding:30px;border:1px solid #222;text-align:center}.inline-link{color:#f60;font-weight:600;cursor:pointer;display:inline;background:0 0;border:none;padding:0;margin:0;font-size:inherit;text-decoration:none}.inline-link:hover{text-decoration:underline}.action-sheet{position:fixed;bottom:0;left:0;right:0;background:#0a0a0a;border-top:1px solid #222;border-radius:24px 24px 0 0;padding:20px;z-index:3000;transform:translateY(100%);transition:transform .3s ease}.action-sheet.open{transform:translateY(0)}.search-container{margin:8px 16px;padding:8px 12px;background:#111;border:1px solid #222;border-radius:12px;display:none;align-items:center;gap:8px}.search-container input{flex:1;background:0 0;border:none;outline:0;color:#fff;font-size:13px;font-weight:500}.search-container input::placeholder{color:#555;font-weight:400}.search-container .close-search{color:#f60;cursor:pointer}#search-results{position:absolute;top:100%;left:0;right:0;background:#000;z-index:90;max-height:300px;overflow-y:auto;display:none;border-bottom:1px solid rgba(255,255,255,.1)}.sunlight-mode #search-results{background:#fff;border-color:#eee}.link-warning{color:#f60;font-size:11px;font-weight:800;margin-top:4px}#post-modal{display:none}.post-modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.95);z-index:2000;display:none;align-items:flex-end;justify-content:center;backdrop-filter:blur(20px)}.post-modal-content{background:#111;width:100%;max-width:600px;border-radius:32px 32px 0 0;padding:24px;border:1px solid #222;border-bottom:none;animation:slideUp .3s ease}.sunlight-mode .post-modal-content{background:#fff;border-color:#eee}@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}#modal-post-input{width:100%;background:#000;border:1px solid #333;border-radius:20px;color:#fff;padding:20px;font-size:18px;margin:20px 0;resize:none;outline:0;min-height:200px}.sunlight-mode #modal-post-input{background:#f4f4f5;color:#121212;border-color:#e4e4e7}.post-modal-footer{position:sticky;bottom:0;background:#111;padding:16px 0 0;border-top:1px solid #222;margin-top:16px}.sunlight-mode .post-modal-footer{background:#fff;border-color:#eee}.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.modal-close{font-size:28px;cursor:pointer;color:#f60}.skeleton-card{background:rgba(15,15,15,.4);border-bottom:1px solid rgba(255,255,255,.08);padding:16px;animation:pulse 1.5s ease-in-out infinite}.sunlight-mode .skeleton-card{background:#f0f0f0;border-color:#e0e0e0}.skeleton-avatar{width:44px;height:44px;border-radius:50%;background:rgba(255,255,255,.1)}.sunlight-mode .skeleton-avatar{background:#ddd}.skeleton-line{height:16px;background:rgba(255,255,255,.1);border-radius:8px;margin-bottom:8px}.sunlight-mode .skeleton-line{background:#ddd}.skeleton-line.short{width:60%}.skeleton-line.medium{width:80%}.skeleton-line.long{width:100%}.skeleton-actions{display:flex;gap:24px;margin-top:16px}.skeleton-action{width:24px;height:24px;background:rgba(255,255,255,.1);border-radius:4px}.sunlight-mode .skeleton-action{background:#ddd}@keyframes pulse{0%,100%{opacity:.7}50%{opacity:.4}}nav,.fixed.bottom-0{visibility:visible!important}#scroll-sentry{height:20px;width:100%;margin:10px 0}.main-content{flex:1;overflow-y:auto;padding-bottom:80px}</style></head><body class="flex flex-col" ontouchstart="closeActionSheetOnTouch(event)"><div id="toast">Gist Published!</div><div id="mention-list"></div><div id="post-modal" class="post-modal-overlay" onclick="closePostModal()"><div class="post-modal-content" onclick="event.stopPropagation()"><div class="modal-header"><h3 id="post-modal-title" class="text-xl font-black uppercase text-sdel">Create Gist</h3><span class="modal-close" onclick="closePostModal()">✕</span></div><textarea id="modal-post-input" placeholder="What's happening, homie?" rows="6" maxlength="500"></textarea><div class="post-modal-footer"><div class="flex gap-3"><button onclick="closePostModal()" class="flex-1 py-4 bg-zinc-900 rounded-2xl font-bold uppercase text-sm">Cancel</button><button id="modal-post-btn" onclick="submitPostFromModal()" class="flex-1 py-4 bg-sdel text-black rounded-2xl font-black uppercase text-sm">Post</button></div></div></div></div><div id="security-modal" class="modal-overlay"><div class="modal-content border-red-900/50"><i data-lucide="shield-alert" class="text-red-600 mx-auto mb-4" size="48"></i><h3 class="text-red-500 font-black uppercase mb-2">Security Warning</h3><p id="security-msg" class="text-xs text-zinc-400 font-bold leading-relaxed mb-6 uppercase">Unauthorized script detected. Your account status has been updated.</p><button onclick="document.getElementById('security-modal').style.display='none'" class="w-full py-4 bg-zinc-900 rounded-2xl font-black text-xs uppercase">I Understand</button></div></div><div id="action-sheet" class="action-sheet"><div class="w-12 h-1.5 bg-zinc-800 rounded-full mx-auto mb-6"></div><div id="action-options" class="space-y-3"></div><button onclick="closeActions()" class="w-full mt-4 py-4 text-zinc-500 font-black uppercase text-xs">Cancel</button></div><div id="redirect-modal" class="modal-overlay"><div class="modal-content"><h3 class="text-lg font-black uppercase mb-2">⚠️ Leaving Sdel</h3><div id="raw-link-display" class="bg-black p-4 rounded-xl border border-zinc-800 text-sdel text-[10px] break-all mb-4 font-bold"></div><p class="text-[9px] text-red-500 font-black uppercase mb-2">This link leads to an external website.</p><p class="text-[9px] text-zinc-500 font-bold uppercase mb-6">Sdel is not responsible for external content.</p><div class="flex gap-3"><button onclick="closeRedirect()" class="flex-1 py-4 bg-zinc-900 rounded-2xl font-bold uppercase text-xs">Abort</button><button id="confirm-redirect-btn" class="flex-1 py-4 bg-sdel text-black rounded-2xl font-black uppercase text-xs">Proceed</button></div></div></div><nav class="sticky top-0 bg-black/90 backdrop-blur-xl z-[100] border-b border-white/5 pt-env(safe-area-inset-top)"><div class="p-6 pb-2 flex items-center justify-between"><h1 class="text-2xl font-black tracking-tighter uppercase">S<span class="text-sdel">del</span> Explore</h1><div class="flex items-center space-x-5"><i data-lucide="search" size="22" onclick="toggleSearch()" style="cursor:pointer;"></i><i data-lucide="bell" size="22" onclick="location.href='messages.html'" style="cursor:pointer;"></i><i data-lucide="message-square" size="22" onclick="location.href='homies.html'" style="cursor:pointer;"></i></div></div><div id="search-container" class="search-container"><i data-lucide="search" size="16" class="text-zinc-500"></i><input type="text" id="search-input" placeholder="Search by name or @username..." oninput="handleSearch(this.value)"><i data-lucide="x" size="16" class="close-search" onclick="toggleSearch()"></i></div><div id="search-results"></div><div class="flex justify-around mt-2"><button id="tab-campus" onclick="switchTab('campus')" class="tab-btn tab-active px-6 py-4">The Campus</button><button id="tab-universe" onclick="switchTab('universe')" class="tab-btn px-6 py-4">Universe</button></div></nav><div class="main-content"><div id="composer-card" class="m-4 p-4 border border-white/5 flex flex-col relative transition-all"><div class="flex space-x-3"><div id="my-avatar" class="w-10 h-10 rounded-full bg-zinc-900 flex-shrink-0 flex items-center justify-center font-bold text-xs border border-white/10 uppercase text-sdel">H</div><div class="flex-1"><textarea id="post-input" placeholder="What's happening, homie?" rows="1" oninput="toggleActions(this)"></textarea><div id="composer-actions" class="mt-3 flex justify-between items-center hidden"><span class="text-[10px] text-zinc-600 font-bold uppercase">Public Gist</span><button onclick="openPostModal()" class="bg-sdel text-black px-4 py-1.5 rounded-full text-[11px] font-black uppercase">Post</button></div></div></div></div><main id="feed-container"><div class="skeleton-card"><div class="flex space-x-3"><div class="skeleton-avatar"></div><div class="flex-1"><div class="skeleton-line short"></div><div class="skeleton-line medium mt-2"></div><div class="skeleton-line long"></div><div class="skeleton-actions"><div class="skeleton-action"></div><div class="skeleton-action"></div><div class="skeleton-action"></div></div></div></div></div><div class="skeleton-card"><div class="flex space-x-3"><div class="skeleton-avatar"></div><div class="flex-1"><div class="skeleton-line short"></div><div class="skeleton-line medium mt-2"></div><div class="skeleton-line long"></div><div class="skeleton-actions"><div class="skeleton-action"></div><div class="skeleton-action"></div><div class="skeleton-action"></div></div></div></div></div><div class="skeleton-card"><div class="flex space-x-3"><div class="skeleton-avatar"></div><div class="flex-1"><div class="skeleton-line short"></div><div class="skeleton-line medium mt-2"></div><div class="skeleton-line long"></div><div class="skeleton-actions"><div class="skeleton-action"></div><div class="skeleton-action"></div><div class="skeleton-action"></div></div></div></div></div></main><div id="scroll-sentry"></div></div><nav class="fixed bottom-0 inset-x-0 p-5 flex justify-around items-center bg-black/95 border-t border-white/10 z-50"><i data-lucide="home" class="text-sdel" size="28" onclick="location.href='dashboard.html'"></i><i data-lucide="compass" class="text-white" size="28" onclick="location.href='explore.html'"></i><div class="bg-sdel h-14 w-14 rounded-2xl flex items-center justify-center -mt-12 shadow-2xl border-4 border-black active:scale-90 transition" onclick="location.href='post-story.html'"><i data-lucide="camera" class="text-black" size="28"></i></div><i data-lucide="shopping-cart" class="text-white" size="28" onclick="location.href='market.html'"></i><i data-lucide="user" class="text-white" size="28" onclick="location.href='profile.html'"></i></nav><script type="module">import{createClient}from'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';const supabase=createClient('https://lgfyrlfjoazedwymjpfc.supabase.co','eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxnZnlybGZqb2F6ZWR3eW1qcGZjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY1MTc1MTksImV4cCI6MjA4MjA5MzUxOX0.g1xVMCtSkkQIu2s1pkvWwxDDvgNGbikAMkyfbZJywVw');let userProfile=null,currentMode='campus',securityViolationCount=0,pressTimer=null,searchQuery='',currentEditPostId=null,repostedPosts=new Set,mentionTimeout=null,currentPage=0,loading=!1,hasMore=!0,allPosts=[],myLikes=[],observer=null,initTimer=null;Object.assign(window,{publishPost,switchTab,safeRedirect,closeRedirect,handleLike,toggleActions,toggleReadMore,handleShare,handleRepost,closeActions,burnGist,banUser,selectMention,toggleSearch,handleSearch,startPress,endPress,editGist,openPostModal,closePostModal,submitPostFromModal});function formatNum(e){return e?e>=1e9?(e/1e9).toFixed(1)+'B':e>=1e6?(e/1e6).toFixed(1)+'M':e>=1e3?(e/1e3).toFixed(1)+'K':e:0}async function init(){if(initTimer&&clearTimeout(initTimer),const{data:{session}}=await supabase.auth.getSession();!session)return window.location.replace('login.html');const{data:e}=await supabase.from('profile').select('*').eq('id',session.user.id).single();if(userProfile=e,userProfile?.is_banned||userProfile?.banned)location.replace('banned.html');document.getElementById('my-avatar').innerText=userProfile?.username?.charAt(0)||'H';const{data:r}=await supabase.from('interactions').select('post_id').eq('user_id',userProfile.id).eq('interaction_type','repost');r&&(repostedPosts=new Set(r.map((e=>e.post_id))));const{data:a}=await supabase.from('interactions').select('post_id').eq('user_id',userProfile.id).eq('interaction_type','like');myLikes=a||[],currentPage=0,allPosts=[],hasMore=!0,initTimer=setTimeout((()=>{const e=document.getElementById('feed-container');e.querySelector('.skeleton-card')&&(e.innerHTML='<div class="text-center py-20 text-zinc-500 font-bold uppercase">No posts yet</div>')}),5e3),await loadMorePosts(),setupInfiniteScroll()}function setupInfiniteScroll(){const e=document.getElementById('scroll-sentry');observer=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&hasMore&&!loading&&loadMorePosts()}))}),{threshold:.1,rootMargin:'200px'}),e&&observer.observe(e)}async function loadMorePosts(){if(!loading&&hasMore){loading=!0,currentPage++;let e=supabase.from('posts').select('*, profile:user_id(username, is_official, is_verified)').eq('post_type','post').order('created_at',{ascending:!1}).range((currentPage-1)*10,currentPage*10-1);currentMode==='campus'&&(e=e.eq('school_name',userProfile?.school_name||'Global'));const{data:r}=await e;if(initTimer&&clearTimeout(initTimer),!r||r.length===0){hasMore=!1,loading=!1,currentPage===1&&(document.getElementById('feed-container').innerHTML='<div class="text-center py-20 text-zinc-500 font-bold uppercase">No posts yet</div>');return}let a=r;searchQuery&&(a=r.filter((e=>e.content.toLowerCase().includes(searchQuery)||e.profile?.username?.toLowerCase().includes(searchQuery))));const t=await Promise.all(a.map((async e=>{const r=await formatContent(e.content,e.id);return{...e,formattedContent:r}})));allPosts=[...allPosts,...t],renderFeed(),loading=!1}}function renderFeed(){const e=document.getElementById('feed-container');if(allPosts.length===0){e.innerHTML='<div class="text-center py-20 text-zinc-500 font-bold uppercase">No posts yet</div>';return}e.innerHTML=allPosts.map((e=>{const r=e.profile?.username||'homie',a=myLikes?.some((e=>e.post_id===e.id)),t=repostedPosts.has(e.id);let l=e.profile?.is_official?'<div class="bg-sdel rounded-full p-[2px] w-[14px] h-[14px] flex items-center justify-center"><i data-lucide="check" class="text-white" size="10" stroke-width="4"></i></div>':e.profile?.is_verified?'<div class="bg-zinc-500 rounded-full p-[2px] w-[14px] h-[14px] flex items-center justify-center"><i data-lucide="check" class="text-white" size="10" stroke-width="4"></i></div>':'';return`<div class="post-card p-4" data-post-id="${e.id}" data-post='${JSON.stringify(e).replace(/'/g,"\\'")}' onmousedown="startPress(event, this.dataset.post)" onmouseup="endPress()" ontouchstart="startPress(event, this.dataset.post)" ontouchend="endPress()"><div class="flex space-x-3"><div onclick="location.href='profile.html?u=${escapeHTML(r)}'" class="w-11 h-11 rounded-full bg-zinc-900 flex-shrink-0 flex items-center justify-center font-black text-sdel text-sm border border-white/10 uppercase cursor-pointer">${escapeHTML(r[0])}</div><div class="flex-1"><div class="flex items-center gap-1.5 mb-1"><span onclick="location.href='profile.html?u=${escapeHTML(r)}'" class="text-[14px] font-black uppercase tracking-tighter cursor-pointer">@${escapeHTML(r)}</span>${l}${currentMode==='universe'?`<span class="ml-auto text-[9px] text-zinc-500 font-bold uppercase">${escapeHTML(e.school_name||'')}</span>`:''}</div><div class="text-[14px] text-zinc-200 leading-snug break-words mb-3">${e.formattedContent}</div><div class="flex items-center justify-between mt-4 text-zinc-500 pr-4"><button onclick="handleLike('${e.id}')" class="like-button flex items-center gap-2" data-post-id="${e.id}" data-liked="${a}" data-count="${e.likes_count||0}"><i data-lucide="heart" size="18" fill="${a?'#FF6600':'none'}" class="like-icon"></i><span class="text-xs font-bold like-count">${formatNum(e.likes_count||0)}</span></button><button onclick="location.href='gist.html?id=${e.id}'" class="flex items-center gap-2"><i data-lucide="message-circle" size="18"></i><span class="text-xs font-bold">${formatNum(e.comments_count||0)}</span></button><button onclick="handleRepost('${e.id}','${escapeHTML(r)}',\`${escapeHTML(e.content)}\`)" class="flex items-center gap-2 ${t?'text-green-500 opacity-50':''}"><i data-lucide="repeat" size="18"></i><span class="text-xs font-bold">${formatNum(e.reposts_count||0)}</span></button><button onclick="handleShare('${e.id}',\`${escapeHTML(e.content)}\`)"><i data-lucide="upload" size="18"></i></button></div></div></div></div>`})).join(''),lucide.createIcons()}async function handleLike(e){const r=document.querySelector(`.like-button[data-post-id="${e}"]`);if(!r)return;const a=r.querySelector('.like-icon'),t=r.querySelector('.like-count'),l=parseInt(t.textContent.replace(/[^0-9]/g,''))||0,o=r.dataset.liked==='true';if(o){a.setAttribute('fill','none'),t.textContent=formatNum(l-1),r.dataset.liked='false';const{data:n}=await supabase.from('interactions').select('*').eq('user_id',userProfile.id).eq('post_id',e).eq('interaction_type','like').single();n&&(await supabase.from('interactions').delete().eq('id',n.id),await supabase.rpc('decrement_stat',{post_id:e,field:'likes_count'})),myLikes=myLikes.filter((e=>e.post_id!==e))}else{a.setAttribute('fill','#FF6600'),t.textContent=formatNum(l+1),r.dataset.liked='true',await supabase.from('interactions').insert({user_id:userProfile.id,post_id:e,interaction_type:'like'}),await supabase.rpc('increment_stat',{post_id:e,field:'likes_count'}),myLikes.push({post_id:e})}}async function handleRepost(e,r,a){if(r===userProfile.username)return showToast("Cannot repost your own gist!"),void 0;if(repostedPosts.has(e))return showToast("Already Reposted!"),void 0;const{data:t}=await supabase.from('profile').select('username').eq('username',r).maybeSingle();if(!t)return showToast("User not found!"),void 0;let l=a;l.includes('Reposted from @')&&(l=l.substring(l.lastIndexOf(':')+1).trim());const o=`Reposted from @${r}: ${l}`;showToast("Reposting...");const{data:n,error:i}=await supabase.from('posts').insert({user_id:userProfile.id,content:o,school_name:userProfile.school_name||'Global',post_type:'repost',likes_count:0,comments_count:0,reposts_count:0,shares_count:0}).select('*, profile:user_id(username, is_official, is_verified)').single();if(!i&&n){await supabase.from('interactions').insert({user_id:userProfile.id,post_id:e,interaction_type:'repost'}),repostedPosts.add(e),await supabase.rpc('increment_stat',{post_id:e,field:'reposts_count'});const r=await formatContent(n.content,n.id);n.formattedContent=r,allPosts=[n,...allPosts],renderFeed(),showToast("Reposted!")}else showToast("Failed to repost")}function closeActionSheetOnTouch(e){const r=document.getElementById('action-sheet');r.classList.contains('open')&&!e.target.closest('.action-sheet')&&closeActions()}async function handleSearch(e){searchQuery=e.toLowerCase();const r=document.getElementById('search-results');if(searchQuery.length>1){const{data:a}=await supabase.from('profile').select('username, first_name, last_name, is_verified').or(`username.ilike.%${searchQuery}%,first_name.ilike.%${searchQuery}%,last_name.ilike.%${searchQuery}%`).limit(5);a?.length>0?(r.innerHTML=a.map((e=>{const r=[e.first_name,e.last_name].filter(Boolean).join(' ')||e.username;return`<div class="p-4 border-b border-white/5 flex items-center justify-between" onclick="location.href='profile.html?u=${e.username}'"><div><span class="text-xs font-black uppercase block">@${e.username}</span><span class="text-[10px] text-zinc-500">${r}</span></div><i data-lucide="chevron-right" size="14" class="text-zinc-600"></i></div>`})).join(''),r.style.display='block',lucide.createIcons()):r.style.display='none'}else r.style.display='none';currentPage=0,allPosts=[],hasMore=!0,await loadMorePosts()}function toggleSearch(){const e=document.getElementById('search-container'),r=document.getElementById('search-results');e.style.display=e.style.display==='none'?'flex':'none',e.style.display==='flex'?document.getElementById('search-input').focus():(searchQuery='',r.style.display='none',currentPage=0,allPosts=[],hasMore=!0,loadMorePosts()),lucide.createIcons()}function startPress(e,r){try{const a=typeof r=='string'?JSON.parse(r):r;pressTimer=setTimeout((()=>{showActionSheet(a)}),800)}catch(a){console.error("Error parsing post data:",a)}}function endPress(){clearTimeout(pressTimer)}async function handleMentions(e){const r=e.value,a=e.selectionStart,t=r.lastIndexOf('@',a-1),l=document.getElementById('mention-list');mentionTimeout&&clearTimeout(mentionTimeout);if(t===-1||r.slice(t,a).includes(' ')){l.style.display='none';return}const o=r.slice(t+1,a);if(o.length===0){l.style.display='none';return}mentionTimeout=setTimeout((async()=>{try{const{data:r}=await supabase.from('profile').select('username, first_name, last_name').ilike('username',`${o}%`).limit(5);if(r&&r.length>0){l.innerHTML=r.map((r=>{const a=[r.first_name,r.last_name].filter(Boolean).join(' ');return`<div class="mention-item" onclick="selectMention('${r.username}',${t},${a})"><span class="font-black">@${r.username}</span>${a?`<span class="text-[9px] text-zinc-400 block">${a}</span>`:''}</div>`})).join('');const r=e.getBoundingClientRect();l.style.top=r.bottom+window.scrollY+5+'px',l.style.left=r.left+'px',l.style.display='block'}else l.style.display='none'}catch(r){console.error("Mention search error:",r),l.style.display='none'}}),300)}function selectMention(e,r,a){const t=document.getElementById('post-input'),l=t.value;t.value=l.slice(0,r)+'@'+e+' '+l.slice(a),document.getElementById('mention-list').style.display='none',t.focus(),t.dispatchEvent(new Event('input'))}function showActionSheet(e){const r=document.getElementById('action-sheet'),a=document.getElementById('action-options'),t=e.user_id===userProfile.id,l=t&&(new Date-new Date(e.created_at)<9e5);let o='';t&&(o+=`<button onclick="burnGist('${e.id}')" class="w-full py-4 bg-red-950/30 text-red-500 rounded-2xl font-black uppercase text-xs flex items-center justify-center gap-2"><i data-lucide="flame" size="16"></i> Burn Gist</button>`,l&&(o+=`<button onclick="editGist('${e.id}', \`${e.content.replace(/`/g,'\\`')}\`)" class="w-full py-4 bg-zinc-900 text-white rounded-2xl font-black uppercase text-xs">Edit Gist</button>`)),userProfile?.is_official&&!t&&(o+=`<button onclick="banUser('${e.user_id}')" class="w-full py-4 bg-red-600 text-black rounded-2xl font-black uppercase text-xs">Ban User</button>`),a.innerHTML=o||'<p class="text-zinc-500 text-xs font-bold uppercase text-center">No actions available</p>',r.classList.add('open'),lucide.createIcons()}function closeActions(){document.getElementById('action-sheet').classList.remove('open')}async function burnGist(e){const{error:r}=await supabase.from('posts').delete().eq('id',e);r||(showToast("Gist Burned!"),allPosts=allPosts.filter((e=>e.id!==e)),renderFeed(),closeActions())}async function banUser(e){await supabase.from('profile').update({is_banned:!0,banned:!0}).eq('id',e),showToast("User Banned!"),closeActions()}function editGist(e,r){currentEditPostId=e,document.getElementById('post-modal-title').innerText='Edit Gist',document.getElementById('modal-post-input').value=r,document.getElementById('modal-post-btn').innerText='Update',openPostModal(),closeActions()}function openPostModal(){currentEditPostId||(document.getElementById('post-modal-title').innerText='Create Gist',document.getElementById('modal-post-input').value=document.getElementById('post-input').value,document.getElementById('modal-post-btn').innerText='Post'),document.getElementById('post-modal').style.display='flex',document.getElementById('modal-post-input').focus()}function closePostModal(){document.getElementById('post-modal').style.display='none',currentEditPostId=null}const harmfulPatterns=[/porn/i,/xxx/i,/adult/i,/sex/i,/nude/i,/onlyfans/i,/fansly/i,/gambling/i,/casino/i,/bet/i,/betting/i,/poker/i,/slot/i,/crypto/i,/bitcoin/i,/eth/i,/investment/i,/forex/i,/drug/i,/weed/i,/cannabis/i,/marijuana/i,/cocaine/i,/hack/i,/cheat/i,/exploit/i,/crack/i,/keygen/i,/violence/i,/gore/i,/kill/i,/death/i,/pharmacy/i,/viagra/i,/cialis/i,/prescription/i];function scanContentForHarmfulLinks(e){const r=/(https?:\/\/[^\s<>"']+)|(www\.[^\s<>"']+\.[^\s<>"']+)|([a-zA-Z0-9][a-zA-Z0-9-]{1,61}[a-zA-Z0-9]\.[a-zA-Z]{2,}[^\s<>"']*)/gi,a=e.match(r)||[];if(a.length>5)return{safe:!1,reason:"Too many links (max 5)"};for(const e of a){const r=e.toLowerCase();for(const a of harmfulPatterns)if(a.test(r))return{safe:!1,reason:"Harmful content detected",url:e}}return{safe:!0}}function cleanHarmfulContent(e){const r=/(https?:\/\/[^\s<>"']+)|(www\.[^\s<>"']+\.[^\s<>"']+)|([a-zA-Z0-9][a-zA-Z0-9-]{1,61}[a-zA-Z0-9]\.[a-zA-Z]{2,}[^\s<>"']*)/gi;return e.replace(r,((e,r)=>{const a=e.toLowerCase();for(const r of harmfulPatterns)if(r.test(a))return"[Link Unavailable]";return e}))}async function submitPostFromModal(){let e=document.getElementById('modal-post-input').value.trim();if(!e)return;const r=scanContentForHarmfulLinks(e);if(!r.safe){if(r.reason==="Too many links (max 5)")return showToast("Maximum 5 links allowed per post!"),void 0;e=cleanHarmfulContent(e),showToast("Some links were removed for safety")}if(/<[^>]*>|javascript:|onerror|onload|eval|alert|document\.|window\.|fetch|XMLHttpRequest|onclick|onmouseover|onfocus|onblur|onchange|onsubmit|onreset|onselect|onkeydown|onkeypress|onkeyup/i.test(e)){document.getElementById('modal-post-input').value='',securityViolationCount++;if(securityViolationCount>=3)await supabase.from('profile').update({is_banned:!0,banned:!0}).eq('id',userProfile.id),location.replace('banned.html');else return closePostModal(),document.getElementById('security-modal').style.display='flex',void setTimeout((()=>location.reload()),3e0)}if(currentEditPostId){const{error:r}=await supabase.from('posts').update({content:e}).eq('id',currentEditPostId);if(!r){showToast("Gist Updated!"),closePostModal();const r=allPosts.findIndex((e=>e.id===currentEditPostId));if(r!==-1){allPosts[r].content=e,allPosts[r].formattedContent=await formatContent(e,currentEditPostId),renderFeed()}}else console.error("Edit error:",r),showToast("Error updating post")}else{const{data:r,error:a}=await supabase.from('posts').insert({user_id:userProfile.id,content:e,school_name:userProfile.school_name||'Global',post_type:'post',likes_count:0,comments_count:0,reposts_count:0,shares_count:0}).select('*, profile:user_id(username, is_official, is_verified)').single();if(!a&&r){showToast("Gist Published!"),document.getElementById('post-input').value='',toggleActions(document.getElementById('post-input')),closePostModal();const a=await formatContent(r.content,r.id);r.formattedContent=a,allPosts=[r,...allPosts],renderFeed()}else console.error("Insert error:",a),showToast("Error: "+a.message)}}function publishPost(){openPostModal()}function escapeHTML(e){const r=document.createElement('div');return r.textContent=e,r.innerHTML}async function formatContent(e,r){let a=e;a=escapeHTML(a),a.length>280&&(a=`<span id="short-${r}">${a.substring(0,250)}... <button onclick="toggleReadMore('${r}')" class="text-sdel font-bold uppercase text-[10px]">Read More</button></span><span id="full-${r}" class="hidden">${a}</span>`);const t=[...a.matchAll(/Reposted from @(\w+):/g)];for(const e of t){const r=e[1];const{data:a}=await supabase.from('profile').select('username').eq('username',r).maybeSingle();a&&(a=a.replace(`Reposted from @${r}:`,`Reposted from <a href="profile.html?u=${r}" class="text-sdel font-bold no-underline hover:underline">@${r}</a>:`))}const l=[...a.matchAll(/@(\w+)/g)];for(const e of l){const r=e[1];if(a.includes(`Reposted from <a`))continue;const{data:t}=await supabase.from('profile').select('username').eq('username',r).maybeSingle();t&&(a=a.replace(new RegExp(`@${r}\\b`),`<a href="profile.html?u=${r}" class="text-sdel font-bold no-underline hover:underline">@${r}</a>`))}const o=/(https?:\/\/[^\s<>"']+)|(www\.[^\s<>"']+\.[^\s<>"']+)|([a-zA-Z0-9][a-zA-Z0-9-]*\.[a-zA-Z]{2,}[^\s<>"']*)/gi;return a=a.replace(o,((e,r)=>{if(e.includes('">')||e.includes('&quot;')||e.includes('profile.html')||e.includes('@'))return e;let a=e;return a.startsWith('http')||(a='https://'+a);const t=escapeHTML(a),l=e.length>50?e.substring(0,50)+'...':e;return a.includes('profile.html')||a.includes('messages.html')||a.includes('homies.html')||a.includes('gist.html')||a.includes('dashboard.html')||a.includes('market.html')||a.includes('explore.html')?`<a href="${t.replace(/'/g,"\\'")}" class="inline-link">${l}</a>`:a.includes('tiktok.com')||a.includes('whatsapp.com')||a.includes('wa.me')||a.includes('thesdel.com')?`<a href="${t.replace(/'/g,"\\'")}" target="_blank" class="inline-link">${l}</a>`:`<a href="#" onclick="event.stopPropagation(); safeRedirect('${t.replace(/'/g,"\\'")}'); return false;" class="inline-link">${l}</a>`})),a}async function handleShare(e,r){const a=`${window.location.origin}/gist.html?id=${e}`;navigator.share?navigator.share({title:'Sdel',text:r,url:a}):(navigator.clipboard.writeText(a),showToast("Link copied!"))}function safeRedirect(e){if(e.includes('profile.html')||e.includes('messages.html')||e.includes('homies.html')||e.includes('gist.html')||e.includes('dashboard.html')||e.includes('market.html')||e.includes('explore.html')){location.href=e;return}document.getElementById('raw-link-display').innerText=e,document.getElementById('redirect-modal').style.display='flex',document.getElementById('confirm-redirect-btn').onclick=()=>{window.open(e,'_blank'),closeRedirect()}}function closeRedirect(){document.getElementById('redirect-modal').style.display='none'}function switchTab(e){currentMode=e,document.getElementById('tab-campus').classList.toggle('tab-active',e==='campus'),document.getElementById('tab-universe').classList.toggle('tab-active',e==='universe'),currentPage=0,allPosts=[],hasMore=!0,document.getElementById('feed-container').innerHTML='<div class="skeleton-card"><div class="flex space-x-3"><div class="skeleton-avatar"></div><div class="flex-1"><div class="skeleton-line short"></div><div class="skeleton-line medium mt-2"></div><div class="skeleton-line long"></div><div class="skeleton-actions"><div class="skeleton-action"></div><div class="skeleton-action"></div><div class="skeleton-action"></div></div></div></div></div><div class="skeleton-card"><div class="flex space-x-3"><div class="skeleton-avatar"></div><div class="flex-1"><div class="skeleton-line short"></div><div class="skeleton-line medium mt-2"></div><div class="skeleton-line long"></div><div class="skeleton-actions"><div class="skeleton-action"></div><div class="skeleton-action"></div><div class="skeleton-action"></div></div></div></div></div><div class="skeleton-card"><div class="flex space-x-3"><div class="skeleton-avatar"></div><div class="flex-1"><div class="skeleton-line short"></div><div class="skeleton-line medium mt-2"></div><div class="skeleton-line long"></div><div class="skeleton-actions"><div class="skeleton-action"></div><div class="skeleton-action"></div><div class="skeleton-action"></div></div></div></div></div>',loadMorePosts()}function toggleActions(e){const r=document.getElementById('composer-card');e.style.height='auto',e.style.height=e.scrollHeight+'px',r.classList.toggle('composer-expanded',e.value.length>50),document.getElementById('composer-actions').classList.toggle('hidden',e.value.length===0),handleMentions(e),setTimeout((()=>{e.scrollTop=e.scrollHeight}),10)}function toggleReadMore(e){document.getElementById(`short-${e}`).classList.add('hidden'),document.getElementById(`full-${e}`).classList.remove('hidden')}function showToast(e){const r=document.getElementById('toast');r.innerText=e,r.classList.add('show'),setTimeout((()=>r.classList.remove('show')),3e3)}init();</script></body></html>
